# Lab 3 - Secure Microservices Architecture

**Name:** Mario David Montero Galvan
**Document ID** 1065833411

## ğŸ§  1. Description
Este proyecto implementa una arquitectura de microservicios segura y escalable basada en los principios de **Secure-by-Design**. Utiliza Flask para los servicios, JWT para autenticaciÃ³n, control de acceso por roles, aislamiento por IP, y `Docker Compose` para orquestar todos los componentes. La arquitectura garantiza una superficie de ataque mÃ­nima y separaciÃ³n estricta entre servicios.

## ğŸ—ï¸ 2. Architecture Overview
**Componentes:**
- **API Gateway**: Punto Ãºnico de entrada, aplica validaciones de IP, JWT y control de rutas.
- **Microservicios**:
  - `auth_service`: autenticaciÃ³n y emisiÃ³n de tokens JWT.
  - `user_service`: manejo de usuarios.
  - `order_service`: gestiÃ³n de pedidos (acceso restringido a rol `admin`).
  - `log_service`: servicio interno para guardar eventos.
- **Simulaciones de bases de datos**: cada servicio lee desde su propio archivo local JSON o TXT.

**Flujo:**
Cliente â†’ Load Balancer  â†’ API Gateway â†’ [auth â†’ user | order | log] â†’ CachÃ©  â†’ base de datos simulada

## ğŸ” 3. Secure-by-Design Tactics
### ğŸ”¹ Limit Exposure
- Solo el API Gateway estÃ¡ expuesto pÃºblicamente.
- Los microservicios estÃ¡n aislados mediante IP y red interna de Docker.

### ğŸ”¹ JWT + Roles
- EmisiÃ³n de tokens por `auth_service`.
- Rutas protegidas y autorizaciÃ³n basada en roles (`user`, `admin`).

### ğŸ”¹ Control por IP
- Middleware `limit_exposure`: solo IPs autorizadas acceden a servicios internos.

### ğŸ”¹ Logging Interno
- `log_service` solo acepta peticiones desde microservicios, no accesible desde el Gateway.

## ğŸš€ 4. Deployment Instructions

### Requisitos previos
- Docker (v24+)
- Docker Compose (2.0+)

### EjecuciÃ³n
```bash
git clone git@github.com:unal-lssa/lssa2025i.git
cd lssa2025i
git checkout team3
cd laboratories/laboratory_3/1065833411
docker compose up --build
```

### Verifica contenedores
```bash
docker ps
```

## ğŸ§ª 5. Testing Guide

### a. Obtener token JWT
```bash
curl -X POST -H "Content-Type: application/json" \
     -d '{"username": "user1", "password": "userpass"}' \
     http://localhost:5000/login
```

### b. Acceso sin token (rechazado)
```bash
curl http://localhost:5000/user
```

### c. Acceso directo a microservicio (rechazado por IP)
```bash
curl http://localhost:5001/ -H "Authorization: Bearer <TOKEN>"
```

### d. Acceso vÃ¡lido vÃ­a API Gateway
```bash
curl http://localhost:5000/user -H "Authorization: Bearer <TOKEN>"
curl http://localhost:5000/order -H "Authorization: Bearer <TOKEN_ADMIN>"
```

### e. Acceso no autorizado por rol
```bash
curl http://localhost:5000/order -H "Authorization: Bearer <TOKEN_USER>"
```

### f. SimulaciÃ³n de lÃ­mite de peticiones (agrega rate limiter si lo deseas)
```bash
for i in {1..6}; do
  curl -X POST -H "Content-Type: application/json" \
       -d '{"username": "user1", "password": "userpass"}' \
       http://localhost:5000/login
  echo ""
done
```

---

Â¡El sistema estÃ¡ diseÃ±ado para facilitar extensiones como: trazabilidad, auditorÃ­a, mÃ©tricas o control granular de permisos usando OAuth o servicios de autorizaciÃ³n dedicados!
