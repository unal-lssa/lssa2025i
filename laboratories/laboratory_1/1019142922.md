# Laboratory 1 - Architectural Design at LHCb

Large Scale Software Architecture

UNAL - 2025 i

## Student

**Name:** Juan Bernardo Benavides Rubio

**Document:** 1019142922

## Project

The [LHCb](https://home.cern/science/experiments/lhcb) is one of the four main detectors at the LHC (Large Hadron Collider). It's main goal is to study the CP violation and other rare phenomena in beauty hadron decays.

In order to accomplish this goal, LHCb needs to process, filter and analyze the data of around 40 Million collisions read by the detector every second. In this document I'll do a high level overview of the architecture that supports operations of this experiment. In particular, I'll talk about the DAQ (Data Acquisition) system in charge receiving the data from the detector (or the simulations), reconstructing events and filtering those that are significant for physics analysis.

This system meets all four of the characteristics of a large scale software architecture cause it needs to process very large volume of data, it needs to run a lot of processes concurrently, it uses multiple components and it involves coordination physical systems in the detector.

Links:

- [LHCb's Gitlab](https://gitlab.cern.ch/lhcb)
- [Gaudi](https://gitlab.cern.ch/lhcb/Gaudi)
- [Moore](https://gitlab.cern.ch/lhcb/Moore)
- [Allen](https://gitlab.cern.ch/lhcb/Allen)
- [Gauss](https://gitlab.cern.ch/lhcb/Gauss)
- [DaVinci](https://gitlab.cern.ch/lhcb/DaVinci)


## View Diagram

![architecture-diagram](./images/1019142922/arch_diagram.svg)

## Elements Descriptions

### Components

- **LHCb detector:** is spectrometer composed of multiple subdetectors specialized in tracking to great detail the particles produced in the collisions. Each of these subdetectors sends is data to specialized frontend electronic systems that send the data (~5Tb/s) to the central DAQ system through high throughput ethernet cables. 
- **LHCb simulations:** Gauss is the framework used by the LHCb to simulate events.
- **Digitization:** Boole is software in charge of transforming simulation results into signals in the same format as those produced by the real detector. The idea is to be able to process the simulated data in the same way as the real data.
- **HLT 1:** Implemented by the Allen Project it runs on GPUs to perform partial event reconstruction and simple trigger decisions to reduce the data rate from ~5Tb/s to 70-200 Gb/s.
- **Buffer:** The data of the selected events is stored in a buffer storage system.
- **Real Time Alignment and Calibration:** Data stored in the buffer is analyzed before entering HLT2 process so that experts can calibrate physical constants and make sure the detector is working fine.
- **HLT 2:** Uses Moore for performing full detector reconstruction and selection of physically significant tracks, taking the throughput down to 10 Gb/s.
- **Calibration storage:** Keeps 6% of events selected by HLT 2 in order to use for callibration purposes. 
- **Full event storage:** For 26% of the events selected by HLT 2, the full raw data is stored in order to allow for full reconstruction in offline analysis.
- **Turbo event storage:** For the rest of selected events, only the data signal candidate is stored, no further reconstruction is possible, but significantly less storage is needed.
- **Sprucing:** Additional reconstruction necessary for processing the events stored in full and for callibration.
- **Stream Storage:** Final storage where events are stored in order to be analyzed by physics group from all around the world.


## References

- [LHCb Starter Kit](https://lhcb.github.io/starterkit-lessons/first-analysis-steps/dataflow-run3.html)
- [The LHCb Upgrade I](https://cds.cern.ch/record/2859353/files/2305.10515.pdf)
- [Computing and Software For LHCb Upgrade 2](https://cds.cern.ch/record/2920838/files/LHCb-PUB-2025-004.pdf)
- [Moore Documentation](https://lhcbdoc.web.cern.ch/lhcbdoc/moore/master/design/architecture.html)
- [The Software Architecture of the LHCb High Level Trigger](https://iopscience.iop.org/article/10.1088/1742-6596/396/1/012053)

